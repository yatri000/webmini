<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartHouse Pro</title>

<style>
:root {
  --bg: #0a0f17;
  --cold: #4fc3ff;
  --card: rgba(255,255,255,0.05);
  --text: #ffffff;
  --muted: #b8c1d1;
  --error: #ff4d4f;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", system-ui, sans-serif;
  background:
    radial-gradient(circle at left, rgba(79,195,255,0.12), transparent 40%),
    var(--bg);
  color: var(--text);
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 24px;
}

h1 {
  font-size: 22px;
  margin-bottom: 16px;
}

.step { display: none; }
.step.active { display: block; }

.card {
  background: var(--card);
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 12px;
  border: 1px solid rgba(255,255,255,0.08);
}

.option {
  cursor: pointer;
  user-select: none;
  touch-action: manipulation;
}

.option.active {
  border-color: var(--cold);
  box-shadow: 0 0 12px rgba(79,195,255,0.4);
}

/* INPUTS */
input, textarea {
  width: 100%;
  border-radius: 14px;
  border: none;
  background: rgba(255,255,255,0.08);
  color: #fff;
}

input {
  padding: 18px;
  font-size: 20px;
  margin-bottom: 14px;
}

textarea {
  padding: 14px;
  font-size: 15px;
  resize: none;
  margin-top: 8px;
}

textarea.comment {
  height: 90px;
}

/* VALIDATION */
input.error { outline: 2px solid var(--error); }
input.valid { outline: 2px solid var(--cold); }

/* BUTTONS */
.btn {
  width: 100%;
  margin-top: 14px;
  padding: 14px;
  border-radius: 14px;
  border: none;
  font-size: 16px;
  font-weight: 600;
}

.btn.primary {
  background: linear-gradient(135deg, var(--cold), #3b82f6);
  color: #fff;
}

.btn.secondary {
  background: transparent;
  color: var(--muted);
  border: 1px solid rgba(255,255,255,0.18);
}

.btn:disabled { opacity: 0.4; }
</style>
</head>

<body>
<div class="container">

<!-- STEP 1 -->
<div class="step active" id="step1">
  <h1>–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å?</h1>

  <div class="card option" data-value="–û—Å–≤–µ—â–µ–Ω–∏–µ">üí° –û—Å–≤–µ—â–µ–Ω–∏–µ</div>
  <div class="card option" data-value="–ö–ª–∏–º–∞—Ç">üå° –ö–ª–∏–º–∞—Ç</div>
  <div class="card option" data-value="–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å">üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</div>
  <div class="card option" data-value="–°—Ü–µ–Ω–∞—Ä–∏–∏">‚öôÔ∏è –°—Ü–µ–Ω–∞—Ä–∏–∏</div>
  <div class="card option" data-value="–®—Ç–æ—Ä—ã">ü™ü –®—Ç–æ—Ä—ã / –∂–∞–ª—é–∑–∏</div>

  <textarea id="comment1" class="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ –∂–µ–ª–∞–Ω–∏—é)"></textarea>

  <button id="next1" class="btn primary" disabled onclick="nextStep()">–î–∞–ª–µ–µ</button>
</div>

<!-- STEP 2 -->
<div class="step" id="step2">
  <h1>–ì–¥–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞?</h1>

  <div class="card option single" data-value="–ö–≤–∞—Ä—Ç–∏—Ä–∞">üè† –ö–≤–∞—Ä—Ç–∏—Ä–∞</div>
  <div class="card option single" data-value="–î–æ–º">üè° –ß–∞—Å—Ç–Ω—ã–π –¥–æ–º</div>
  <div class="card option single" data-value="–û—Ñ–∏—Å">üè¢ –û—Ñ–∏—Å</div>
  <div class="card option single" data-value="–ï—Å—Ç—å —Å–∏—Å—Ç–µ–º–∞">üõ† –£–∂–µ –µ—Å—Ç—å —É–º–Ω—ã–π –¥–æ–º</div>

  <textarea id="comment2" class="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (—ç—Ç–∞–∂, —Å—Ç–∞–¥–∏—è —Ä–µ–º–æ–Ω—Ç–∞ –∏ —Ç.–ø.)"></textarea>

  <button class="btn secondary" onclick="prevStep()">–ù–∞–∑–∞–¥</button>
  <button id="next2" class="btn primary" disabled onclick="nextStep()">–î–∞–ª–µ–µ</button>
</div>

<!-- STEP 3 -->
<div class="step" id="step3">
  <h1>–ö–∞–∫ —Å –≤–∞–º–∏ —Å–≤—è–∑–∞—Ç—å—Å—è?</h1>

  <input id="name" placeholder="–ò–º—è">
  <input id="phone" placeholder="+7 ___ _______" inputmode="numeric">

  <div class="card option" data-value="–¢–µ–ª–µ—Ñ–æ–Ω">üìû –ó–≤–æ–Ω–æ–∫</div>
  <div class="card option" data-value="WhatsApp">üí¨ WhatsApp</div>
  <div class="card option" data-value="Telegram">ü§ñ Telegram</div>

  <button class="btn secondary" onclick="prevStep()">–ù–∞–∑–∞–¥</button>
  <button id="send" class="btn primary" disabled onclick="submitForm()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
</div>

<!-- STEP 4 -->
<div class="step" id="step4">
  <h1>‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</h1>
  <button class="btn primary" onclick="closeApp()">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ Telegram</button>
</div>

</div>

<script>
/* ---------- TELEGRAM SAFE ---------- */
const tg = window.Telegram?.WebApp || {
  ready(){},
  sendData(d){ console.log("BROWSER MODE DATA:", d); },
  close(){}
};
tg.ready();

let step = 1;

/* ---------- AUTO NAME ---------- */
const name = document.getElementById("name");
const phone = document.getElementById("phone");
const next1 = document.getElementById("next1");
const next2 = document.getElementById("next2");
const send  = document.getElementById("send");
const comment1 = document.getElementById("comment1");
const comment2 = document.getElementById("comment2");

if (tg.initDataUnsafe?.user) {
  name.value = tg.initDataUnsafe.user.first_name || "";
}

/* ---------- OPTION HANDLER ---------- */
document.addEventListener("click", e => {
  const opt = e.target.closest(".option");
  if (!opt) return;

  if (opt.classList.contains("single")) {
    opt.parentElement.querySelectorAll(".option.single")
      .forEach(o => o.classList.remove("active"));
    opt.classList.add("active");
  } else {
    opt.classList.toggle("active");
  }
  validate();
});

/* ---------- NAME ---------- */
name.addEventListener("input", () => {
  name.value = name.value.replace(/[^a-zA-Z–∞-—è–ê-–Ø—ë–Å\s-]/g, "");
  validate();
});

function validateName() {
  return /^[a-zA-Z–∞-—è–ê-–Ø—ë–Å\s-]{2,}$/.test(name.value.trim());
}

/* ---------- PHONE MASK (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø) ---------- */
let phoneDigits = "";

phone.addEventListener("focus", () => {
  if (!phone.value) phone.value = "+7 ";
});

phone.addEventListener("input", () => {
  let raw = phone.value.replace(/\D/g, "");

  // —É–±–∏—Ä–∞–µ–º –≤–µ–¥—É—â—É—é 7
  if (raw.startsWith("7")) raw = raw.slice(1);

  raw = raw.slice(0, 10);
  phoneDigits = raw;

  let formatted = "+7 ";
  if (phoneDigits.length <= 3) {
    formatted += phoneDigits;
  } else {
    formatted += phoneDigits.slice(0,3) + " " + phoneDigits.slice(3);
  }

  phone.value = formatted;

  if (phoneDigits.length === 10) {
    setTimeout(() => phone.blur(), 50);
  }

  validate();
});

// –∑–∞—â–∏—Ç–∞ "+7 "
phone.addEventListener("keydown", e => {
  if (phone.selectionStart <= 3 && (e.key === "Backspace" || e.key === "Delete")) {
    e.preventDefault();
  }
});

function validatePhone() {
  return phoneDigits.length === 10;
}

/* ---------- VALIDATION ---------- */
function validate() {
  next1.disabled = !(
    document.querySelector("#step1 .option.active") ||
    comment1.value.trim()
  );

  next2.disabled = !(
    document.querySelector("#step2 .option.active") ||
    comment2.value.trim()
  );

  send.disabled = !(
    validateName() &&
    validatePhone() &&
    document.querySelectorAll("#step3 .option.active").length
  );
}

/* ---------- NAVIGATION ---------- */
function nextStep() {
  document.getElementById(`step${step}`).classList.remove("active");
  step++;
  document.getElementById(`step${step}`).classList.add("active");
}

function prevStep() {
  document.getElementById(`step${step}`).classList.remove("active");
  step--;
  document.getElementById(`step${step}`).classList.add("active");
}

/* ---------- SUBMIT ---------- */
function submitForm() {
  tg.sendData(JSON.stringify({
    interests: [...document.querySelectorAll("#step1 .option.active")].map(e=>e.dataset.value),
    object: document.querySelector("#step2 .option.active")?.dataset.value,
    comments: [comment1.value, comment2.value].filter(Boolean),
    name: name.value.trim(),
    phone: "+7 " + phoneDigits.slice(0,3) + " " + phoneDigits.slice(3),
    contacts: [...document.querySelectorAll("#step3 .option.active")].map(e=>e.dataset.value)
  }));
  nextStep();
}

function closeApp(){ tg.close(); }
</script>

</body>
</html>
